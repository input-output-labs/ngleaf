<p class="password-change-key-disclaimer" *ngIf="state === 'SendPassword'">
  {{ "leaf.password-forgotten.passwordChangeKeyDisclaimerLabel" | translate }}
</p>
<form
  [formGroup]="sendPasswordChangeForm"
  *ngIf="state === 'SendPassword'"
  (keypressed.enter)="sendPasswordChangeKey()"
>
  <mat-form-field [color]="color" appearance="outline" class="email" [subscriptSizing]="'dynamic'">
    <mat-label>{{
      "leaf.password-forgotten.emailLabel" | translate
    }}</mat-label>
    <input
      matInput
      class="password-forgotten-email"
      type="text"
      formControlName="email"
      [placeholder]="'leaf.password-forgotten.emailPlaceholder' | translate"
    />
  </mat-form-field>
  <button
    mat-stroked-button
    [color]="color"
    class="send-password-button"
    (click)="sendPasswordChangeKey()"
  >
    {{ "leaf.password-forgotten.sendPasswordChangeKeyButtonLabel" | translate }}
  </button>
</form>
<form
  [formGroup]="passwordChangeForm"
  (keypressed.enter)="changePassword()"
  *ngIf="state === 'PasswordChange'"
>
  <mat-form-field [color]="color" appearance="outline" class="email" [subscriptSizing]="'dynamic'">
    <mat-label>{{
      "leaf.password-forgotten.passwordChangeKeyLabel" | translate
    }}</mat-label>
    <input
      matInput
      class="password-change-key"
      type="text"
      formControlName="passwordChangeKey"
      autocomplete="off"
      [placeholder]="
        'leaf.password-forgotten.passwordChangeKeyPlaceholder' | translate
      "
    />
  </mat-form-field>

  <mat-form-field [color]="color" appearance="outline" class="email" [subscriptSizing]="'dynamic'">
    <mat-label>{{
      "leaf.password-forgotten.passwordLabel" | translate
    }}</mat-label>
    <input
      matInput
      class="password-change-password"
      [type]="showPassword ? 'text' : 'password'"
      formControlName="password"
      autocomplete="off"
      [placeholder]="'leaf.password-forgotten.passwordPlaceholder' | translate"
    />
    <button matSuffix mat-icon-button (click)="showPassword = !showPassword" type="button">
      <mat-icon>{{ showPassword ? 'visibility' : 'visibility_off'}}</mat-icon>
    </button>
  </mat-form-field>
  <leaf-password-security-indicator
    *ngIf="showPasswordSecurityLevel"
    [passwordControl]="passwordChangeForm.get('password')"
    [minimumPasswordSecurity]="minimumPasswordSecurity">
  </leaf-password-security-indicator>
  <mat-error *ngIf="hasMinimumPasswordSecurityError()" class="form-error">
    {{getMinimumPasswordSecurityErrorMessage()}}
  </mat-error>

  <mat-form-field [color]="color" appearance="outline" class="email" [subscriptSizing]="'dynamic'">
    <mat-label
      >{{
        "leaf.password-forgotten.passwordValidationLabel" | translate
      }}</mat-label
    >
    <input
      matInput
      class="password-change-password-validation"
      [type]="showPasswordValidation ? 'text' : 'password'"
      formControlName="passwordValidation"
      autocomplete="off"
      [placeholder]="
        'leaf.password-forgotten.passwordValidationPlaceholder' | translate
      "
    />
    <button matSuffix mat-icon-button (click)="showPasswordValidation = !showPasswordValidation" type="button">
      <mat-icon>{{ showPasswordValidation ? 'visibility' : 'visibility_off'}}</mat-icon>
    </button>
    <mat-error *ngIf="passwordChangeForm.errors?.passwordsMismatch && passwordChangeForm.touched">
      {{ 'leaf.password-forgotten.passwordsMismatchError' | translate }}
    </mat-error>
  </mat-form-field>

  <button
    mat-stroked-button
    [color]="color"
    class="password-change-button"
    (click)="changePassword()"
    [disabled]="!passwordChangeForm.valid"
  >
    {{ "leaf.password-forgotten.changePasswordButtonLabel" | translate }}
  </button>

  <a
    class="password-change-resend-link"
    href
    (click)="resendEmail($event)"
    *ngIf="emailToResendTo"
  >
    {{ "leaf.password-forgotten.resendLinkLabel" | translate }}
  </a>
</form>
